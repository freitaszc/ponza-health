<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8">
  <title>Responder Cotação - Ponza Health</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="icon" href="{{ url_for('static', filename='images/favicon.ico') }}" type="image/x-icon">
  <link href="https://fonts.googleapis.com/css2?family=Funnel+Sans:wght@400;600;700&display=swap" rel="stylesheet">
  <style>
    :root {
      --bg: #0b1220;
      --panel: rgba(11, 18, 32, .82);
      --panel-light: rgba(15, 24, 43, .88);
      --ink: #e5e7eb;
      --ink-muted: #cbd5e1;
      --accent: #38bdf8;
      --accent-dark: #0ea5e9;
      --radius: 18px;
      --shadow: 0 18px 40px rgba(2, 6, 23, .45);
    }

    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 36px 18px;
      font-family: 'Funnel Sans', system-ui, -apple-system, sans-serif;
      background:
        radial-gradient(1200px 800px at 10% -10%, rgba(14, 165, 233, .18), transparent 55%),
        radial-gradient(900px 700px at 90% 0%, rgba(59, 130, 246, .18), transparent 60%),
        linear-gradient(180deg, #020617 0%, #0f172a 100%);
      color: var(--ink);
    }

    .card {
      width: min(820px, 100%);
      background: linear-gradient(150deg, var(--panel) 0%, var(--panel-light) 100%);
      border-radius: var(--radius);
      padding: 32px;
      box-shadow: var(--shadow);
      border: 1px solid rgba(148, 163, 184, .22);
    }

    .card-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      flex-wrap: wrap;
      gap: 18px;
      margin-bottom: 24px;
    }

    .brand {
      display: flex;
      align-items: center;
      gap: 14px;
    }

    .brand img {
      height: 52px;
      width: auto;
    }

    .brand-meta {
      display: flex;
      flex-direction: column;
      gap: 4px;
    }

    .brand-name {
      font-weight: 700;
      font-size: 18px;
      letter-spacing: .01em;
    }

    .brand-address {
      font-size: 14px;
      color: var(--ink-muted);
      max-width: 360px;
      line-height: 1.4;
    }

    h1 {
      margin: 0 0 6px;
      font-size: clamp(28px, 5vw, 36px);
      font-weight: 700;
      letter-spacing: .01em;
    }

    .subtitle {
      margin: 0 0 26px;
      font-size: 16px;
      color: var(--ink-muted);
    }

    .supplier-tag {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      padding: 8px 14px;
      border-radius: 999px;
      background: rgba(56, 189, 248, .16);
      color: #e0f2fe;
      font-weight: 600;
      margin-bottom: 18px;
    }

    .status {
      padding: 14px;
      border-radius: 12px;
      background: rgba(34, 197, 94, .12);
      color: #bbf7d0;
      border: 1px solid rgba(34, 197, 94, .25);
      margin-bottom: 22px;
      font-size: 15px;
    }

    .status.error {
      background: rgba(248, 113, 113, .12);
      color: #fecaca;
      border-color: rgba(248, 113, 113, .28);
    }

    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 12px;
      color: var(--ink);
    }

    th, td {
      padding: 14px 12px;
      border: 1px solid rgba(148, 163, 184, .18);
      text-align: left;
      font-size: 15px;
    }

    th {
      background: rgba(15, 23, 42, .72);
      font-weight: 700;
    }

    td:first-child {
      width: 55%;
    }

    input[type="text"], input[type="number"] {
      width: 100%;
      padding: 12px 14px;
      border-radius: 12px;
      border: 1px solid rgba(148, 163, 184, .35);
      background: rgba(15, 23, 42, .8);
      color: var(--ink);
      font-size: 15px;
      font-family: 'Funnel Sans', sans-serif;
      outline: none;
      transition: border-color .18s, box-shadow .18s;
    }

    input[type="text"]:focus, input[type="number"]:focus {
      border-color: var(--accent);
      box-shadow: 0 0 0 3px rgba(14, 165, 233, .25);
    }

    .actions {
      display: flex;
      justify-content: flex-end;
      margin-top: 26px;
    }

    button {
      border: none;
      border-radius: 999px;
      padding: 12px 26px;
      font-size: 16px;
      font-weight: 700;
      cursor: pointer;
      background: linear-gradient(135deg, var(--accent) 0%, var(--accent-dark) 100%);
      color: #0f172a;
      box-shadow: 0 12px 24px rgba(14, 165, 233, .32);
      transition: transform .16s, box-shadow .16s;
    }

    button:hover {
      transform: translateY(-2px);
      box-shadow: 0 18px 36px rgba(14, 165, 233, .45);
    }

    button:disabled {
      opacity: .6;
      cursor: not-allowed;
      box-shadow: none;
    }

    .expired {
      text-align: center;
      font-size: 18px;
      color: var(--ink-muted);
      margin: 28px 0 0;
    }

    @media (max-width: 640px) {
      .card {
        padding: 24px 18px;
      }

      .card-header {
        justify-content: center;
        text-align: center;
      }

      .brand {
        flex-direction: column;
      }

      .brand-meta {
        align-items: center;
      }

      .brand img {
        height: 44px;
      }

      th, td {
        font-size: 14px;
      }
    }
  </style>
</head>
<body>
  <div class="card">
    <div class="card-header">
      <div class="brand">
        <img src="{{ url_for('static', filename='images/3.svg') }}" alt="Ponza Health">
        <div class="brand-meta">
          <span class="brand-name">{{ clinic_name or 'Equipe Ponza Health' }}</span>
          {% if clinic_address %}
          <span class="brand-address">{{ clinic_address }}</span>
          {% endif %}
        </div>
      </div>
      <img src="{{ url_for('static', filename='images/favicon.ico') }}" alt="Ponza Health" style="height:42px;width:auto;">
    </div>

    <h1>Responder Cotação</h1>
    <p class="subtitle">{{ clinic_name or 'Equipe Ponza Health' }} convidou você para informar preços e prazos.</p>

    <div class="supplier-tag">
      <span>Fornecedor:</span>
      <strong>{{ supplier.name }}</strong>
    </div>

    {% if expired %}
      <div class="status error">Este link expirou. Solicite um novo link à clínica.</div>
      <p class="expired">Dica: reenviar a cotação pelo WhatsApp gera um token atualizado automaticamente.</p>
    {% else %}
      {% if submitted %}
        <div class="status">Obrigado! Suas informações foram registradas com sucesso. Se precisar atualizar, basta ajustar os campos e enviar novamente.</div>
      {% endif %}

      {% if error_message %}
        <div class="status error">{{ error_message }}</div>
      {% endif %}

      {% if not items %}
        <div class="status error">Esta cotação não possui itens cadastrados. Entre em contato com a clínica.</div>
      {% else %}
      <form method="post" novalidate>
        <table aria-label="Formulário de resposta da cotação">
          <thead>
            <tr>
              <th>Item</th>
              <th>Preço Unitário (R$)</th>
              <th>Prazo (dias)</th>
            </tr>
          </thead>
          <tbody>
            {% for idx, item in items %}
            <tr>
              <td>{{ item }}</td>
              <td>
                <input type="text" name="price_{{ idx }}" inputmode="decimal" placeholder="Ex: 125,90" value="{{ prefill_prices[idx] }}">
              </td>
              <td>
                <input type="number" name="deadline_{{ idx }}" min="0" step="1" placeholder="Ex: 5" value="{{ prefill_deadlines[idx] }}">
              </td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
        <div class="actions">
          <button type="submit">Enviar Resposta</button>
        </div>
      </form>
      {% endif %}
    {% endif %}
  </div>
</body>
</html>
