<!DOCTYPE html>
<html lang="pt-br">

<head>
  <meta charset="UTF-8" />
  <title>Profissionais - Ponza Health</title>
  <link rel="icon" href="{{ url_for('static', filename='images/favicon.ico') }}" type="image/x-icon" />

  <!-- Preload: aplica estado colapsado ANTES do primeiro paint -->
  <script>
    (function () {
      try {
        if (localStorage.getItem('sidebarCollapsed') === '1') {
          document.documentElement.classList.add('sidebar-collapsed');
        }
      } catch (_) { }
    })();
  </script>

  <!-- Fonts / Icons -->
  <link href="https://fonts.googleapis.com/css2?family=Funnel+Sans:wght@300;400;500;600;700&display=swap"
    rel="stylesheet" />
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" />

  <style>
    /* ===== Page/base layout (outside of shadow) ===== */
    :root {
      --bg: #ffffff;
      --surface: #ffffff;
      --surface-alt: #f8fafc;
      --border: #e5e7eb;
      --ink: #0b1220;
      --ink-dim: #475569;
      --brand-grad: linear-gradient(180deg, #131d35 0%, #0f182b 100%);
      --brand-solid: #131d35;
      --shadow: 0 8px 20px rgba(2, 6, 23, .06);
      --font-family: 'Funnel Sans', system-ui, -apple-system, Segoe UI, Roboto, 'Helvetica Neue', Arial, sans-serif;
      --btn-h: 44px;
      --btn-minw: 220px;
    }

    * {
      box-sizing: border-box
    }

    html,
    body {
      margin: 0
    }

    body {
      min-height: 100vh;
      display: flex;
      font-family: var(--font-family);
      color: var(--ink);
      background: var(--bg);
      font-size: 14px;
    }

    /* Topo direito */
    .top-profile {
      position: fixed;
      top: 18px;
      right: 28px;
      z-index: 1001;
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .icon-btn {
      position: relative;
      border: 1px solid var(--border);
      background: var(--surface);
      width: 44px;
      height: 44px;
      border-radius: 12px;
      cursor: pointer;
      display: grid;
      place-items: center;
      box-shadow: var(--shadow);
      transition: transform .15s, box-shadow .15s, border-color .15s;
      text-decoration: none;
    }

    .icon-btn:hover {
      transform: translateY(-1px);
      box-shadow: 0 10px 24px rgba(2, 6, 23, .12);
      border-color: var(--brand-solid)
    }

    .icon-btn i {
      color: var(--brand-solid);
      font-size: 18px
    }

    .icon-btn .badge {
      position: absolute;
      top: 6px;
      right: 6px;
      min-width: 16px;
      height: 16px;
      padding: 0 4px;
      border-radius: 999px;
      background: var(--brand-solid);
      color: #fff;
      font-size: 10px;
      font-weight: 800;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    /* ===== Content ===== */
    .content {
      flex: 1 1 auto;
      padding: 36px;
      min-width: 0;
      position: relative
    }

    h2 {
      font-size: 32px;
      text-align: center;
      margin: 0 0 28px;
      position: relative;
      color: var(--ink)
    }

    h2::after {
      content: '';
      position: absolute;
      bottom: -10px;
      left: 50%;
      transform: translateX(-50%);
      width: 80px;
      height: 4px;
      background: var(--brand-grad);
      border-radius: 2px;
      box-shadow: 0 0 8px rgba(0, 0, 0, .12);
    }

    .actions-row {
      display: flex;
      justify-content: center;
      gap: 12px;
      flex-wrap: wrap;
      margin: 8px 0 18px
    }

    .btn {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      height: var(--btn-h);
      min-width: var(--btn-minw);
      padding: 0 22px;
      border-radius: 999px;
      font-weight: 800;
      font-size: 14px;
      border: 1px solid var(--brand-solid);
      cursor: pointer;
      transition: .22s;
      text-decoration: none;
      color: #fff;
      background: var(--brand-grad);
      box-shadow: var(--shadow);
    }

    .btn:hover {
      transform: translateY(-2px) scale(1.02);
      box-shadow: 0 12px 24px rgba(2, 6, 23, .12)
    }

    .btn.btn-outline {
      background: #fff;
      color: var(--brand-solid)
    }

    .filter-form {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
      justify-content: center;
      margin: 12px 0 16px
    }

    .menu-input,
    .menu-select {
      padding: 12px 14px;
      border-radius: 10px;
      border: 1px solid var(--border);
      background: #fff;
      color: var(--ink);
      font-size: 14px;
      outline: none;
      transition: .2s;
      font-family: var(--font-family);
    }

    .menu-input:focus,
    .menu-select:focus {
      border-color: var(--brand-solid);
      box-shadow: 0 0 0 4px rgba(19, 29, 53, .12)
    }

    .panel {
      background: var(--surface);
      padding: 24px;
      border-radius: 16px;
      box-shadow: var(--shadow);
      max-width: 1100px;
      margin: 0 auto;
      border: 1px solid var(--border);
    }

    table {
      width: 100%;
      border-collapse: collapse;
      color: var(--ink);
      border: 1px solid var(--border);
      border-radius: 12px;
      overflow: hidden
    }

    thead th {
      background: var(--brand-grad);
      color: #fff;
      font-weight: 800;
      letter-spacing: .02em;
      padding: 12px 14px;
      text-align: center;
      font-size: 16px
    }

    tbody td {
      padding: 12px 14px;
      border-top: 1px solid var(--border);
      text-align: center;
      color: #334155
    }

    tbody tr:nth-child(even) {
      background: #fafafa
    }

    tbody tr:hover {
      background: rgba(19, 29, 53, .06)
    }

    .name-link {
      color: var(--ink);
      text-decoration: none;
      font-weight: 700
    }

    .name-link:hover {
      text-decoration: underline
    }

    .icon-square {
      width: 36px;
      height: 36px;
      display: grid;
      place-items: center;
      border: 1px solid var(--border);
      background: #fff;
      border-radius: 10px;
      box-shadow: var(--shadow);
      cursor: pointer;
      transition: transform .15s, box-shadow .15s, border-color .15s, background .15s;
      font-size: 18px;
      line-height: 1;
    }

    .icon-square:hover {
      transform: translateY(-1px);
      box-shadow: 0 10px 24px rgba(0, 0, 0, .12);
      border-color: var(--brand-solid);
      background: #fafafa
    }

    .icon-square.danger:hover {
      border-color: #ef4444;
      background: #fee2e2
    }

    @media (max-width: 720px) {
      .content {
        padding: 24px
      }

      .btn {
        min-width: 100%
      }

      .filter-form .menu-select,
      .filter-form .search-compact {
        width: 100%
      }
    }
  </style>
</head>

<body>
  <!-- Topo direito -->
  <div class="top-profile" aria-label="Ações do usuário">
    <a href="{{ url_for('account') }}" class="icon-btn" title="Minha conta" aria-label="Minha conta"><i
        class="fa fa-user"></i></a>
    <button class="icon-btn" type="button" title="Notificações" aria-label="Notificações"><i
        class="fa fa-bell"></i><span class="badge">{{ (notifications_unread or 0) }}</span></button>
  </div>

  <!-- Conteúdo -->
  <div class="content">
    <h2>Profissionais</h2>

    <div class="actions-row">
      <button type="button" class="btn btn-outline" onclick="openModal()">
        <i class="fa fa-plus" style="margin-right:6px;"></i>Novo Profissional
      </button>
    </div>

    <!-- Filtros -->
    <form class="filter-form" method="get" action="{{ url_for('doctors') }}">
      <input class="menu-input" type="search" name="q" placeholder="Buscar (nome, CRM, especialidade, e-mail)"
        value="{{ request.args.get('q','') }}" style="width:320px">
      <select class="menu-select" name="specialty">
        <option value="">Todas as especialidades</option>
        {% for s in specialties %}
        <option value="{{ s }}" {% if request.args.get('specialty')==s %}selected{% endif %}>{{ s }}</option>
        {% endfor %}
      </select>
      <button class="btn" type="submit"><i class="fa fa-search" style="margin-right:6px;"></i>Filtrar</button>
    </form>

    <!-- Tabela -->
    <div class="panel">
      <table>
        <thead>
          <tr>
            <th>Nome</th>
            <th>CRM</th>
            <th>Especialidade</th>
            <th>E-mail</th>
            <th style="text-align:center;">Ações</th>
          </tr>
        </thead>
        <tbody>
          {% for d in doctors %}
          <tr>
            <td><a class="name-link" href="{{ url_for('doctor_view', doctor_id=d.id) }}">{{ d.name }}</a></td>
            <td>{{ d.crm or '—' }}</td>
            <td>{{ d.specialty or '—' }}</td>
            <td>{{ d.email or '—' }}</td>
            <td style="text-align:center;">
              <div style="display:inline-flex;align-items:center;gap:8px;">
                <a class="icon-square" href="{{ url_for('doctor_view', doctor_id=d.id) }}#edit" title="Editar"
                  aria-label="Editar"><i class="fa fa-pencil"></i></a>
                <form method="post" action="{{ url_for('doctor_delete', doctor_id=d.id) }}"
                  onsubmit="return confirm('Remover este profissional?')" style="margin:0;">
                  <button type="submit" class="icon-square danger" title="Remover" aria-label="Remover"><i
                      class="fa fa-trash"></i></button>
                </form>
              </div>
            </td>
          </tr>
          {% else %}
          <tr>
            <td colspan="5" style="color:var(--ink-dim);text-align:center;">Nenhum profissional encontrado.</td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>

  <!-- Modal (igual ao seu) -->
  <div id="modal" class="modal" aria-hidden="true"
    style="display:none; position:fixed; inset:0; background:rgba(0,0,0,.55); justify-content:center; align-items:center; z-index:20000;">
    <div class="modal-card" role="dialog" aria-modal="true" aria-labelledby="modal-title"
      style="width:90%; max-width:720px; background:#fff; border:1px solid var(--border); border-radius:16px; box-shadow:0 25px 60px rgba(0,0,0,.2); padding:0; overflow:hidden;">
      <div class="modal-head"
        style="display:flex; justify-content:space-between; align-items:center; padding:14px 18px; background:var(--surface-alt); border-bottom:1px solid var(--border);">
        <h3 id="modal-title" class="modal-title" style="margin:0; font-size:18px; font-weight:800;">Cadastrar novo
          profissional</h3>
        <button class="modal-close" type="button" onclick="closeModal()" aria-label="Fechar"
          style="background:#fff; border:1px solid var(--border); width:36px; height:36px; border-radius:10px; display:grid; place-items:center; cursor:pointer;"><i
            class="fa fa-times"></i></button>
      </div>
      <form class="modal-body" method="post" action="{{ url_for('add_doctor_route') }}" style="padding:18px;">
        <div class="modal-grid" style="display:grid; grid-template-columns:1fr 1fr; gap:12px;">
          <div><span class="label"
              style="font-size:12px; color:var(--ink-dim); font-weight:800; letter-spacing:.04em; margin-bottom:6px; display:block;">NOME*</span>
            <input class="input" type="text" name="name" placeholder="Nome completo" required
              style="width:100%; padding:12px 14px; border:1px solid var(--border); border-radius:12px; font-size:15px; font-family:var(--font-family);" />
          </div>
          <div><span class="label">CRM</span>
            <input class="input" type="text" name="crm" placeholder="CRM"
              style="width:100%; padding:12px 14px; border:1px solid var(--border); border-radius:12px; font-size:15px; font-family:var(--font-family);" />
          </div>
          <div><span class="label">TELEFONE</span>
            <input class="input" type="tel" name="phone" placeholder="(00) 00000-0000"
              style="width:100%; padding:12px 14px; border:1px solid var(--border); border-radius:12px; font-size:15px; font-family:var(--font-family);" />
          </div>
          <div><span class="label">E-MAIL</span>
            <input class="input" type="email" name="email" placeholder="email@exemplo.com"
              style="width:100%; padding:12px 14px; border:1px solid var(--border); border-radius:12px; font-size:15px; font-family:var(--font-family);" />
          </div>
          <div style="grid-column:1/-1;"><span class="label">ESPECIALIDADE</span>
            <input class="input" type="text" name="specialty" placeholder="Ex.: Cardiologia"
              style="width:100%; padding:12px 14px; border:1px solid var(--border); border-radius:12px; font-size:15px; font-family:var(--font-family);" />
          </div>
        </div>
        <div class="modal-actions"
          style="display:flex; justify-content:center; gap:12px; padding:16px 18px; border-top:1px solid var(--border);">
          <button class="btn btn-outline" type="button" onclick="closeModal()">Cancelar</button>
          <button class="btn" type="submit">Cadastrar</button>
        </div>
      </form>
    </div>
  </div>
</body>

</html>